---
- name: Make function keys default on a Logitech K380 keyboard
  when: is_logitech_k380_keyboard_used | bool
  block:
    - name: Install GCC
      become: true
      apt:
        name: gcc
        state: present

    - name: Clone k380-function-keys-conf
      become: true
      become_user: '{{ user_name }}'
      git:
        repo: '{{ k380_function_keys_conf_repository_url }}'
        dest: '{{ k380_function_keys_conf_directory_path }}'

    - name: Build k380-function-keys-conf
      become: true
      become_user: '{{ user_name }}'
      command: ./build.sh
      args:
        chdir: '{{ k380_function_keys_conf_directory_path }}'

    - name: Copy rules to make function keys default on a Logitech K380 keyboard
      become: true
      copy:
        src: '{{ k380_function_keys_conf_directory_path }}/80-k380.rules'
        dest: /etc/udev/rules.d/80-k380.rules

    - name: Signal systemd-udevd to reload the rulesâ€™ files
      become: true
      command: udevadm control --reload
